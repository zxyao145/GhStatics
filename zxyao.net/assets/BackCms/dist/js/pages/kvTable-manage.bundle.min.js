!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=35)}({0:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={getIdByRoute:function(){var e=location.pathname.split("/").filter((function(e){return!!e}));return e[e.length-1]},pickUpUrlParams:function(){var e=location.search,t={keys:[],params:{},get:function(e){return""}};if(-1!==e.indexOf("?")){for(var r=e.substr(1).split("&"),a=[],n={},o=0;o<r.length;o++){var l=r[o].split("="),i=l[0].toLocaleLowerCase();n[i]?n[i]=[n[i],unescape(l[1])]:n[i]=unescape(l[1]),a.push(i)}t.keys=a,t.params=n,t.get=function(e){var t=e.toLocaleLowerCase();return a.includes(t)?n[e]:""}}return t}};t.default=a},1:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(2);var a={decimal:"",emptyTable:"数据不存在",info:"当前数据为 _START_ 到 _END_，共计 _TOTAL_ 条数据",infoEmpty:"无数据",infoFiltered:"(筛选自 _MAX_ 条数据)",infoPostFix:"",thousands:",",lengthMenu:"每页 _MENU_ 行",loadingRecords:"加载中...",processing:"处理中...",search:"搜索:",zeroRecords:"没有找到任何匹配的结果",paginate:{first:"第一页",last:"最后一页",next:"下一页",previous:"前一页"},aria:{sortAscending:": activate to sort column ascending",sortDescending:": activate to sort column descending"}},n=function(){function e(){this.selector=null,this.dataTable=null,this.where={}}return Object.defineProperty(e.prototype,"selectIdArr",{get:function(){return this.getSelectIdArray()},enumerable:!0,configurable:!0}),e.prototype.render=function(e){e.key||(e.key="Id"),this.config=e;var t=this,r=e.order;r||(r=[[3,"desc"]]);var n={processing:!0,serverSide:!0,ajax:function(r,a,n){if(e.moreDataFields&&e.moreDataFields instanceof Array)for(var o=0;o<e.moreDataFields.length;o++){var l=e.moreDataFields[o];r.columns.push({data:l,name:"",searchable:!0,orderable:!0})}var i=[];if(t.where)for(var s in t.where)if(t.where.hasOwnProperty(s)){var c=t.where[s];i.push(s+"="+c)}r.where=i,$.ajax({url:e.ajaxUrl,type:"Post",data:r,success:function(e){e.error||a(e)}})},responsive:!1,details:!1,order:r,lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,pagingType:"full_numbers",language:a,select:"multi",scrollY:"400",scrollX:!0,columnDefs:e.columnDefs,columns:e.columns,buttons:[{extend:"colvis",text:"列"}],dom:"R<'row'<'col-sm-12 col-md-6'Bl><'col-sm-12 col-md-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",initComplete:function(r,a){t.bingSearchEvent(),$("#selectAll").click((function(){$("#selectAll").is(":checked")?$("tbody tr:not(.selected) .row-selector input").click():$("tbody tr.selected .row-selector input").click()})),"function"==typeof e.initComplete&&e.initComplete()}};this.dataTable=$(e.selector).DataTable(n),this.dataTable.buttons().container().appendTo($(".col-sm-6:eq(0)",this.dataTable.table().container()));this.dataTable.on("draw",(function(r){"function"==typeof e.afterDraw&&e.afterDraw(r,t.dataTable.rows().data()),$(e.selector+" tbody .row-selector>input").on("click",(function(){$(this).parents("tr").toggleClass("selected"),t.getSelectIdArray()})),$(".row-selector input").change((function(){0===$("tbody tr:not(.selected)").length?$("#selectAll").prop("checked","checked"):$("#selectAll").prop("checked",null)}))}))},e.prototype.filter=function(e){if(void 0===e&&(e=null),this.where={},e)for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];this.where[t]=r}this.search()},e.prototype.search=function(){var e=$("#dataTable_filter input").val();""===e||e?this.dataTable.search(e).draw():this.dataTable.ajax.reload()},e.prototype.innerSearch=function(e){void 0===e&&(e=""),this.dataTable.search(e).draw()},e.prototype.reset=function(){this.where={},this.dataTable.search("").draw()},e.prototype.resetSearch=function(){this.innerSearch("")},e.prototype.resetFilter=function(){$(".filter-container>select>option:first-child").prop("selected",!0),this.where={},this.search()},e.prototype.reload=function(){this.dataTable.ajax.reload()},e.prototype.bingSearchEvent=function(){$("#dataTable_filter input").unbind();var e=this;$("#dataTable_filter input").on("keyup",(function(t){13==t.keyCode&&e.search()})),$("#dataTable_filter input").on("input",(function(t){$(t.target).val()||e.search()}))},e.prototype.getSelectIdArray=function(){var e=this.dataTable.rows(".selected").data(),t=this.config.key,r=e.map((function(e){return e[t]}));return r.length>0?r.splice(0,r.length):[]},e.checkBoxCol=function(e){return void 0===e&&(e="Id"),{data:""+e,width:"40px",orderable:!1,searchable:!1,title:'<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="selectAll"><label class="custom-control-label" for="selectAll"></label></div>',render:function(e,t,r,a){return'<div class="custom-control custom-checkbox row-selector">\n                    <input type="checkbox" class="custom-control-input" id="row_'+e+'" value="'+e+'">\n                    <label class="custom-control-label" for="row_'+e+'"></label>\n                 </div>'}}},e.defaultFilterEvent=function(e){var t={};$(".filter-container>select").each((function(e,r){var a=$(r),n=a.val();n!==a.find("option").eq(0).val()&&(t[a.attr("name")]=n)})),$(".filter-container>.bootstrap-select>select").each((function(e,r){var a=$(r),n=a.val();n!==a.find("option").eq(0).val()&&(t[a.attr("name")]=n)})),e.filter(t)},e.defautlDelete=function(e,t,r,a,n){var o;return void 0===r&&(r=null),void 0===a&&(a=null),void 0===n&&(n=null),0===(o=r||e.selectIdArr).length?(alert("未选择项目"),!1):($.ajax({url:t,data:{idArr:o},type:"post",success:function(e){"function"==typeof a&&a(e)},error:function(e,t,r){"function"==typeof n&&n(e,t,r)}}),!0)},e}();t.default=n},2:function(e,t,r){},35:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(1));r(4);var o,l,i,s,c,u=a(r(5)),d=r(6);r(36),o="/api/KvTable/ChangeStatus",l=null,i=new n.default,s=function(e,t){switch(void 0===t&&(t=null),t||(t=i.selectIdArr),e.toLocaleLowerCase()){case"del":u.default.showLoading(),n.default.defautlDelete(i,"/api/KvTable/Delete",t,(function(e){i.reload(),u.default.hideLoading(),i.reload()}),(function(e,t,r){console.log(e,t,r),alert("网络错误"),u.default.hideLoading()}))||u.default.hideLoading();break;case"draft":$.post(o,{idArr:t,status:d.DefaultStatus.Draft},(function(e){i.reload()}));break;case"published":$.post(o,{idArr:t,status:d.DefaultStatus.Published},(function(e){i.reload()}));break;case"secret":$.post(o,{idArr:t,status:d.DefaultStatus.Secret},(function(e){i.reload()}));break;case"see":if(l){for(var r=t[0],a=void 0,s="",c=0,f=l;c<f.length;c++){var p=f[c];if(p.Id===r){a=p.Key,s=p.Value;break}}a&&($("#dataModal .modal-title").html("Key: "+a),$("#dataModal .modal-body").html(s),$("#dataModal").modal("show"))}}},c={selector:"#dataTable",columnDefs:[{targets:3,visible:!0},{targets:5,visible:!1}],order:[[1,"asc"]],columns:[n.default.checkBoxCol(),{data:"Key",title:"Key",render:function(e,t,r,a){return e}},{data:"Status",title:"状态",render:function(e,t,r,a){var n="badge-info",o=e;return o===d.DefaultStatus.Published?n="badge-success":o===d.DefaultStatus.Secret?n="badge-warning":o===d.DefaultStatus.Deleted&&(n="badge-danger"),'<span class="badge '+n+' status" data-status="'+o+'" data-id="'+r.Id+'">'+d.getStatusText(o)+"</span>"}},{data:"Create",title:"创建时间",render:function(e,t,r,a){return e.iso8601ToDate().format("yyyy-MM-dd HH:mm:ss")}},{data:"Modify",title:"修改时间",render:function(e,t,r,a){return e.iso8601ToDate().format("yyyy-MM-dd HH:mm:ss")}},{data:"Value",title:"Value",render:function(e,t,r,a){return'<div class="row-content">'+e+"</div>"}},{data:"Id",title:"操作",render:function(e,t,r,a){return'<div class="btn-group ">\n                    <button class="btn btn-primary btn-sm row-see" data-id="'+e+'">查看</button>                    \n                    <a class="btn btn-secondary btn-sm" href="/BackCms/KvTable/Edit?Id='+e+'">修改</a>\n                    <button class="btn btn-danger btn-sm row-del" data-id="'+e+'">删除</button>\n                    </div>'}}],ajaxUrl:"/api/KvTable/Table",initComplete:function(){$(".table-tool .filter").click((function(e){n.default.defaultFilterEvent(i)})),$(".table-tool .reset").click((function(e){i.resetFilter()})),$(".del").click((function(){s("del")}))},afterDraw:function(e,t){l=t,$("tbody .status").on("click",(function(e){var t=$(e.target),r=parseInt(t.data("status")),a=t.data("id");switch(r){case d.DefaultStatus.Deleted:s("Draft",[a]);break;case d.DefaultStatus.Draft:s("Published",[a]);break;case d.DefaultStatus.Published:s("Draft",[a])}})),$("tbody .row-del").on("click",(function(e){e.preventDefault();var t=$(e.target).data("id");s("del",[t])})),$("tbody .row-see").on("click",(function(e){e.preventDefault();var t=$(e.target).data("id");s("see",[t])}))}},i.render(c)},36:function(e,t,r){},4:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),String.prototype.isEmail=function(){var e=this.replace(" ","");return!!/^([\w-.]+)@([\w_-]+\.)+([a-zA-Z0-9]+)/i.test(e)},String.prototype.iso8601ToLocal=function(){return this.replace(/T/g," ")},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)if(t.hasOwnProperty(r)&&new RegExp("("+r+")").test(e)){var a=t[r];e=e.replace(RegExp.$1,1===RegExp.$1.length?a:("00"+a).substr((""+a).length))}return e},String.prototype.iso8601ToDate=function(){return new Date(this)}},5:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(0)),o={showLoading:function(e){void 0===e&&(e=null);var t=window.scrollY+"px",r=window.scrollX+"px";$("html").addClass("disableScroll"),e&&$(".loading .content>span").html(e),$(".loading").css({display:"flex",top:t,bottom:"-"+t,left:r,right:"-"+r})},hideLoading:function(){$(".loading").css("display","none"),$("html").removeClass("disableScroll")},getEditInfo:function(e){void 0===e&&(e="id");var t=n.default.pickUpUrlParams().get(e),r={};return t?(r.isEdit=!0,r.id=t):(r.isEdit=!1,r.id=""),r},getFromDataObj:function(e){var t=$(e).serialize().split("&"),r={};return t.forEach((function(e){var t=e.split("=");r[t[0]]=decodeURIComponent(t[1])})),r},alert:function(e,t){void 0===t&&(t=null);var r={time:2e3,title:"提示"};t?"function"==typeof t?window.layer.alert(e,r,t):($.extend(t,r),window.layer.alert(e,t)):window.layer.alert(e,r)},alertError:function(e){var t=e.map((function(e){return e.Message})).join("<br/>>");o.alert(t,{title:"错误",icon:2})},confirm:function(e,t,r){void 0===r&&(r=null),window.layer.confirm(e,{title:"提示"},(function(e){t(),window.layer.close(e)}),(function(e){r&&r(),window.layer.close(e)}))}};t.default=o},6:function(e,t,r){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Deleted=-1]="Deleted",e[e.Draft=1]="Draft",e[e.Published=2]="Published",e[e.Secret=3]="Secret"}(a||(a={})),t.DefaultStatus=a;t.getStatusText=function(e){switch(e){case a.Deleted:return"已删除";case a.Draft:return"草稿";case a.Published:return"已发布";case a.Secret:return"私密";default:return"未知"}}}});